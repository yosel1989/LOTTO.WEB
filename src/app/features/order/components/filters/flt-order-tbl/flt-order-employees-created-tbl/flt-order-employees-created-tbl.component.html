<div>
    <p-iconfield>
        <p-inputicon class="pi pi-user text-xs!" />
        <input 
        #trigger
        fluid="true" 
        size="small" 
        pSize="small"  
        placeholder="Todo"  
        type="text" 
        pInputText 
        readonly
        class="text-xs! truncate ps-[32px]! py-1! h-[30px]! items-center!"
        [formControl]="ctrlText"
        (click)="toggle($event)"/>
        @if(ctrlText.value !== null){<p-inputicon title="Limpiar" class="pi pi-times text-xs!" (click)="evtClear()" />}
    </p-iconfield>
    <p-popover #popover class="w-full! custom-popover" styleClass="custom-popover" appendTo="body">
        <div class="flex flex-col gap-2 w-full text-xs!">
            <div>
                <span class="block mb-2">{{ title }}</span>
                <p-select 
                autofocus="true"
                [formControl]="ctrlMode" 
                size="small" 
                [options]="filterModes" 
                optionLabel="label" 
                optionValue="value" 
                placeholder="Todo" 
                class="text-xs h-[30px]! min-w-[220px] max-w-[220px]"
                panelStyleClass="text-xs!">
                    <ng-template #selectedItem let-selectedOption>
                        <div class="w-full flex flex-row items-center gap-1">
                            <span>{{ selectedOption.label }}</span>
                        </div>
                    </ng-template>

                    <ng-template let-mode #item>
                        <div class="w-full flex flex-row items-center justify-between gap-2">
                            <span>{{ mode.label }}</span>
                        </div>
                    </ng-template>
                </p-select>
            </div>
            <div id="container" class="flex flex-col gap-1">
                @if(ctrlMode.value === 'single'){
                    <p-select 
                    [formControl]="ctrlSingle"
                    fluid
                    autofocus="true"
                    size="small" 
                    [options]="data" 
                    [optionLabel]="optionLabel" 
                    [optionValue]="optionValue" 
                    [placeholder]="placeholder" 
                    class="text-xs h-[30px]! max-w-[220px]"
                    panelStyleClass="text-xs!" />
                }

                @if(ctrlMode.value === 'multiple'){
                    <!--<p-multiselect 
                    [formControl]="ctrlMultiple"
                    fluid
                    [options]="data" 
                    placeholder="Seleccionar" 
                    [optionLabel]="optionLabel" 
                    [optionValue]="optionValue" 
                    [placeholder]="placeholder"
                    size="small"
                    inputId="text-xs"
                    [maxSelectedLabels]="1"
                    class="max-w-[220px] h-[30px]! text-xs!"
                    panelStyleClass="text-xs!"
                    appendTo="#container"/>-->

                    <p-listbox
                    #listBox 
                    listStyleClass="text-xs!"
                    [options]="data" 
                    [formControl]="ctrlMultiple" 
                    [optionLabel]="optionLabel" 
                    [optionValue]="optionValue"
                    [checkbox]="true"
                    [metaKeySelection]="false"
                    [virtualScroll]="true"
                    [virtualScrollItemSize]="40"
                    [filter]="true"
                    [multiple]="true"
                    scrollHeight="150px"
                    [striped]="true"
                    fluid
                    size="small"
                    class="min-w-[220px] max-w-[220px] text-xs!">
                        
                        <!--<ng-template pTemplate="filter" let-options="options">
                            <p-iconfield iconPosition="left">
                                <p-inputicon class="pi pi-search text-xs!" />
                                <input 
                                #inputFilter 
                                type="text" 
                                pInputText 
                                pSize="small" 
                                placeholder="Buscar ..." 
                                styleClass="text-xs!" 
                                fluid class="text-xs! ps-[30px]!"
                                (input)="evtT(options)"
                                />
                            </p-iconfield>
                        </ng-template>-->

  
                        <ng-template #item let-item>
                            <div class="flex items-center gap-2">
                                <div>{{ item[optionLabel] }}</div>
                            </div>
                        </ng-template>
                    </p-listbox>

                }
                
            </div>
            
            <div class="flex flex-row justify-between gap-1 mt-3">
                <p-button 
                size="small"
                outlined="true"
                icon="pi pi-filter text-xs!" 
                label="Aplicar" 
                styleClass="h-[25px]! w-full!"
                pTooltip="Aplicar filtros" 
                tooltipPosition="top"
                tooltipStyleClass="text-xs!"
                placeholder="Top"
                (click)="evtApply()"
                ></p-button>

                @if(ctrlText.value !== null){
                    <p-button 
                    size="small"
                    outlined="true"
                    severity="danger"
                    icon="pi pi-filter-slash" 
                    label="Limpiar" 
                    styleClass="h-[25px]!"
                    pTooltip="Quitar filtros" 
                    tooltipPosition="top"
                    tooltipStyleClass="text-xs!"
                    placeholder="Top"
                    (click)="evtClear()"
                    ></p-button>
                }
            </div> 
        </div>
    </p-popover>
</div>