<div>
    <p-iconfield>
        <p-inputicon class="pi pi-calendar text-xs!" />
        <input 
        #trigger
        fluid="true" 
        size="small" 
        pSize="small"  
        placeholder="Todo"  
        type="text" 
        pInputText 
        readonly
        class="text-xs! ps-[32px]!"
        [formControl]="ctrlText"
        (click)="toggle($event)"/>
        @if(ctrlText.value !== null){<p-inputicon title="Limpiar" class="pi pi-times text-xs!" (click)="evtClear()" />}
    </p-iconfield>
    <p-popover #popover class="w-full! custom-popover" styleClass="custom-popover" appendTo="body">
        <div class="flex flex-col gap-2 w-full text-xs!">
            <div>
                <span class="block mb-2">{{ title }}</span>
                <p-select 
                autofocus="true"
                [formControl]="ctrlMode" 
                size="small" 
                [options]="filterModes" 
                optionLabel="label" 
                optionValue="value" 
                placeholder="Todo" 
                class="text-xs min-w-[220px] h-[30px]!"
                panelStyleClass="text-xs!" />
            </div>

            @if(ctrlMode.value === 'range'){
                <div class="flex flex-col gap-2">
                    <div class="flex flex-col gap-1">
                        <label class="font-normal">
                        Desde <span class="text-red-300">*</span>
                        </label>
                        <p-datepicker
                            size="small" 
                            [formControl]="ctrlDateStart"
                            fluid
                            [showOnFocus]="true" 
                            [readonlyInput]="true"
                            inputStyleClass="text-xs!"
                            [iconDisplay]="'input'" 
                            [showIcon]="true"
                            panelStyleClass="text-xs!"
                            [touchUI]="isMobile"
                            [invalid]="submitted && ctrlDateStart.hasError('required')"
                            />
                            @if (submitted && ctrlDateStart.hasError('required')) {
                                <p-message severity="error" size="small" variant="simple" class="text-xs">Debe seleccionar la fecha.</p-message>
                            }
                    </div>
                    
                    <div class="flex flex-col gap-1">
                        <label class="font-normal">
                        Hasta <span class="text-red-300">*</span>
                        </label>
                        <p-datepicker
                            [formControl]="ctrlDateEnd"
                            size="small" 
                            fluid
                            [showOnFocus]="true" 
                            [readonlyInput]="true"
                            inputStyleClass="text-xs!"
                            [iconDisplay]="'input'" 
                            [showIcon]="true"
                            panelStyleClass="text-xs!"
                            [touchUI]="isMobile"
                            [invalid]="submitted && ctrlDateEnd.hasError('required')"
                            />
                        @if (submitted && ctrlDateEnd.hasError('required')) {
                            <p-message severity="error" size="small" variant="simple" class="text-xs">Debe seleccionar la fecha.</p-message>
                        }
                        @if (submitted && ctrlDateEnd.hasError('dateEndBeforeStart')) {
                            <p-message severity="error" size="small" variant="simple" class="text-xs">Debe ser mayor a la fecha inicial</p-message>
                        }
                    </div>
                </div>
            }

            @if(ctrlMode.value === 'date'){
                <div class="flex flex-col gap-1">
                    <label class="font-normal">
                    Fecha <span class="text-red-300">*</span>
                    </label>
                    <p-datepicker
                        [formControl]="ctrlDate"
                        size="small" 
                        fluid
                        [showOnFocus]="true" 
                        [readonlyInput]="true"
                        inputStyleClass="text-xs!"
                        [iconDisplay]="'input'" 
                        [showIcon]="true"
                        panelStyleClass="text-xs!"
                        [touchUI]="isMobile"
                        [invalid]="submitted && ctrlDate.hasError('required')"
                        />
                    @if (submitted && ctrlDate.hasError('required')) {
                        <p-message severity="error" size="small" variant="simple" class="text-xs">Debe seleccionar la fecha.</p-message>
                    }
                </div>
            }
            
            <div class="flex flex-row justify-between gap-1 mt-3">
                <p-button 
                size="small"
                outlined="true"
                icon="pi pi-filter text-xs!" 
                label="Aplicar" 
                styleClass="h-[25px]! w-full!"
                pTooltip="Aplicar filtros" 
                tooltipPosition="top"
                tooltipStyleClass="text-xs!"
                placeholder="Top"
                (click)="evtApply()"
                ></p-button>

                @if(ctrlText.value !== null){
                    <p-button 
                    size="small"
                    outlined="true"
                    severity="danger"
                    icon="pi pi-filter-slash" 
                    label="Limpiar" 
                    styleClass="h-[25px]!"
                    pTooltip="Quitar filtros" 
                    tooltipPosition="top"
                    tooltipStyleClass="text-xs!"
                    placeholder="Top"
                    (click)="evtClear()"
                    ></p-button>
                }
            </div> 
        </div>
    </p-popover>
</div>